# **AI 圖像風格轉換平台**

## **環境配置**

在 Colab 環境中部署本專案，其程式碼結構是為解決雲端環境特有的挑戰所形成。

### **使用到的重要函式庫**

- `torch` (PyTorch 深度學習框架)：
  - **專案中的作用：** 提供 GPU 算力支持，是 `StableDiffusionImg2ImgPipeline` 執行張量運算和模型推理的基礎。模型載入和執行依賴 `torch` 的資料型別和設備管理功能。
  - **與 Colab 環境的關聯：** `torch` 包含底層二進制組件，`!pip install` 後若 Python 解釋器未重啟，可能無法正確加載，導致 `ModuleNotFoundError`。此外，`torch` 版本需與 Colab 的 CUDA 版本（如 `cu121`）精確匹配，這促使安裝時需指定 `--index-url`。
- `numpy` (數值計算基礎函式庫)：
  - **專案中的作用：** 作為 Python 科學計算的基礎，為 `torch`、`diffusers`、`matplotlib`、`wordcloud` 等函式庫提供底層數值運算和數據結構支持。
  - **與 Colab 環境的關聯：** `numpy` 版本不兼容可能導致依賴它的其他函式庫（如 `diffusers` 內部依賴的 `onnxruntime`）運行異常。`numpy.dtype size changed` 等錯誤直接反映了 `numpy` 數據類型定義與其他函式庫編譯時所依賴的版本之間存在二進制不匹配。

### **錯誤現象與修正動作**

1. 錯誤：`ModuleNotFoundError` (如 `torch`, `gradio`)。
   - **分析：** 函式庫未被正確加載，Colab 環境具臨時性。
   - **修正：** 引入 `sys.exit(0)`，強制運行時重啟，促使函式庫重新加載。
2. 錯誤：`ImportError` (如 `transformers` 找不到)。
   - **分析：** 即使分步重啟，函式庫仍未加載，多階段重啟造成環境重置循環。
   - **修正：** 將所有安裝命令集中於一個 Cell，並僅在末尾執行一次 `sys.exit(0)`，確保一次性完整配置並重啟。
3. 錯誤：`numpy` 版本衝突、`numpy.dtype size changed`。
   - **分析：** 底層二進制不兼容。
   - **修正：** 徹底卸載現有 `numpy`，精確安裝兼容版本 (`numpy==1.26.4`)。PyTorch 也指定 CUDA 版本。

### **選擇此結構的考量**

- **目標：** 在單一 Colab 筆記本中，實現圖片生成、透過 Gradio 連結並提供自訂介面。
- **挑戰：** 預配置工具（如 Foocus）缺乏底層控制，無法解決深層次依賴衝突。
- **解決方案：** 該結構是針對 Colab 環境臨時性、函式庫加載行為及複雜依賴衝突的直接解決方案。透過自主控制環境配置，達成所有功能整合的目標。

## **代碼結構介紹**

### **核心功能函式**

- **圖像生成函式：** 處理用戶輸入（圖片、風格、提示詞）和基於回饋的關鍵字，調用 AI 模型生成圖像。
- **回饋處理函式：** 接收用戶的「喜歡/不喜歡」選擇，將相關關鍵字記錄在全局變數中。
- **關鍵字雲函式：** 將累積的關鍵字數據可視化為詞雲圖。
- **清空回饋函式：** 提供重置用戶偏好數據的選項。

### **Gradio 界面構建與啟動**

- 使用 `gradio` 組件（如圖像框、下拉菜單、按鈕）搭建自訂 Web 界面。
- 將 UI 元素的操作（如點擊按鈕）與上述功能函式精確綁定。
- 最後，啟動 Gradio 服務，生成一個可供外部訪問的 URL，使專案應用可以在瀏覽器中互動。

## **工具使用流程**

**初始生成：**

- 用戶可以選擇風格，給予關鍵字。此時右側的「正面」/「負面」關鍵字顯示欄為空。
- 系統基於當前輸入和預設狀態生成圖片。

<img src="https://i.meee.com.tw/a7AtkPg.png" style="zoom:50%;" />

**回饋收集與影響：**

- 用戶若對生成的圖片感到滿意，可點選「喜歡」並按下「反饋」按鈕。
- 「正面」區會即時記錄下用戶回饋中包含的關鍵字，例如「長髮」。

<img src="https://i.meee.com.tw/ylAzJta.png" style="zoom:50%;" />

**基於回饋的動態生成：**

- 此時，若清空輸入的關鍵字，再次執行生成操作，系統將自動納入先前收集的「正面」關鍵字（如「長髮」）。
- 生成的圖片將會反映這些回饋關鍵字的影響，例如，若先前因「長髮」而滿意並提供回饋，本次生成將更傾向於產生長髮的圖像。

<img src="https://i.meee.com.tw/ZUOq4u4.png" style="zoom:50%;" />